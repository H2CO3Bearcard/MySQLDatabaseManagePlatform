<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>M.D.B.M.P | 信息总览</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/font-awesome/css/font-awesome.css" rel="stylesheet">
    <!-- Toastr style -->
    <link href="/static/css/plugins/toastr/toastr.min.css" rel="stylesheet">
    <!-- Gritter -->
    <link href="/static/js/plugins/gritter/jquery.gritter.css" rel="stylesheet">
    <link href="/static/css/animate.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
    <!-- Mainly scripts -->
    <script src="/static/js/jquery-3.1.1.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <script src="/static/js/popper.min.js"></script>
    <script src="/static/js/bootstrap.js"></script>
    <script src="/static/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="/static/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <!-- Custom and plugin javascript -->
    <script src="/static/js/inspinia.js"></script>
    <script src="/static/js/plugins/pace/pace.min.js"></script>
    <script src="/static/js/plugins/toastr/toastr.min.js"></script>
    <script src="/static/js/plugins/sparkline/jquery.sparkline.min.js"></script>
    <script src="/static/js/plugins/chartJs/Chart.min.js"></script>
</head>

<body>
<div id="wrapper">
    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element">
                        <a href="/index/"><h1>M.D.B.M.P</h1></a>
                    </div>
                </li>
                {% for foo in menu_grouop_obj %}
                    <li>
                        <a href="{{ foo.group_url }}"><i class="fa {{ foo.group_icon }}"></i> <span
                                class="nav-label">{{ foo.group_name }}</span><span
                                class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse">
                            {% for fooo in menus_obj %}
                                {% if foo.id == fooo.menu_group_id %}
                                    <li><a href="{{ fooo.menu_url }}">{{ fooo.menu_name }}</a></li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </nav>
    <div id="page-wrapper" class="gray-bg dashbard-1">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                <div class="navbar-header">
                    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i>
                    </a>
                </div>
                <ul class="nav navbar-top-links navbar-right">
                    <li style="padding: 20px">
                        <span class="m-r-sm text-muted welcome-message"><i class="fa fa-user-o"> </i> {{ request.user }}，欢迎来到MySQL数据库管理平台</span>
                    </li>
                    <li style="padding: 10px;">
                        <span class="text-muted text-xs block">您的身份是：{{ identity }}</span>
                    </li>
                    <li>
                        <a href="/logout/">
                            <i class="fa fa-sign-out"></i> 注销
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        <div class="row wrapper border-bottom white-bg page-heading">
            <div class="col-lg-10">
                <h2>信息总览</h2>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="/index/">信息总览</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a>信息总览</a>
                    </li>
                    <li class="breadcrumb-item active">
                        <strong>信息总览</strong>
                    </li>
                </ol>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-3">
                <div class="widget style1 red-bg">
                    <div class="row">
                        <div class="col-4 text-center">
                            <i class="fa fa-user-o fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span> 当前用户 </span>
                            <h2 class="font-bold">{{ request.user }}</h2>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="widget style1 navy-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-user fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span> 用户身份 </span>
                            <h2 class="font-bold">{{ identity }}</h2>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="widget style1 lazur-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-address-book fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span> 当前用户数 </span>
                            <h2 class="font-bold">{{ user_number }}</h2>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="widget style1 yellow-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-desktop fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span> 当前服务器数 </span>
                            <h2 class="font-bold">{{ server_number }}</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox ">
                    <div class="ibox-content">
                        <div>
                            <h1 class="m-b-xs">服务器内存状态监控</h1>
                        </div>

                        <div>
                            <iframe class="chartjs-hidden-iframe"
                                    style="width: 100%; display: block; border: 0px; height: 0px; margin: 0px; position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;"></iframe>
                            <canvas id="ServerFree" height="536" width="2300"
                                    style="display: block; width: 1150px; height: 268px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox ">
                    <div class="ibox-content">
                        <div>
                            <h1 class="m-b-xs">服务器CPU负载监控</h1>
                        </div>

                        <div>
                            <canvas id="CpuLoad" height="536" width="2300"
                                    style="display: block; width: 1150px; height: 268px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>数据库在线情况</h5>

                        </div>
                        <div class="ibox-content">
                            <div><iframe class="chartjs-hidden-iframe" style="width: 100%; display: block; border: 0px; height: 0px; margin: 0px; position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;"></iframe>
                                <canvas id="DbOnline" height="606" width="1300" style="display: block; width: 650px; height: 303px;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
    </div>
</div>
<script>
    function load_data(){
                   $.ajax({
                url: '/index_get_monitor/',
                type: 'POST',
                dataType: 'JSON',
                success: function (data) {
                    var lineData = {
                        labels: [data[9]['date'],data[8]['date'],data[7]['date'],
                            data[6]['date'],data[5]['date'],data[4]['date'],data[3]['date']
                            ,data[2]['date'],data[1]['date'],data[0]['date']],
                        datasets: [
                            {
                                label: "内存使用率",
                                backgroundColor: "rgba(26,179,148,0.5)",
                                borderColor: "rgba(26,179,148,0.7)",
                                pointBackgroundColor: "rgba(26,179,148,1)",
                                pointBorderColor: "#fff",
                                data: [data[9]['free_used'], data[8]['free_used'], data[7]['free_used'], data[6]['free_used'],
                                    data[5]['free_used'], data[4]['free_used'], data[3]['free_used'],data[2]['free_used'],
                                data[1]['free_used'],data[0]['free_used']]
                            }
                        ]
                    };
                    var lineOptions = {
                        responsive: true,
                        animation : false,
                        bezierCurve: false,
                    };
                    var ctx = document.getElementById("ServerFree").getContext("2d");
                    new Chart(ctx, {type: 'line', data: lineData, options:lineOptions});

                    var CpuData = {
                        labels: [data[9]['date'],data[8]['date'],data[7]['date'],
                            data[6]['date'],data[5]['date'],data[4]['date'],data[3]['date']
                            ,data[2]['date'],data[1]['date'],data[0]['date']],
                        datasets: [
                            {
                                label: "CPU平均负载",
                                backgroundColor: "rgba(26,179,148,0.5)",
                                borderColor: "rgba(26,179,148,0.7)",
                                pointBackgroundColor: "rgba(26,179,148,1)",
                                pointBorderColor: "#fff",
                                data: [data[9]['cpu_load'], data[8]['cpu_load'], data[7]['cpu_load'], data[6]['cpu_load'],
                                    data[5]['cpu_load'], data[4]['cpu_load'], data[3]['cpu_load'],data[2]['cpu_load'],
                                data[1]['cpu_load'],data[0]['cpu_load']]
                           }
                        ]
                    };
                    var cpu_load = document.getElementById("CpuLoad").getContext("2d");
                    new Chart(cpu_load, {type: 'line', data: CpuData, options:lineOptions});

                }
            });
    }
    function load_data2() {
        var doughnutData = {
        labels: ["online","failed" ],
        datasets: [{
            data: [{{ online_db }},{{ failed_db }}],
            backgroundColor: ["#65de78","#cf1b0e"]
        }]
    } ;
    var doughnutOptions = {
        responsive: true
    };
    var ctx4 = document.getElementById("DbOnline").getContext("2d");
    new Chart(ctx4, {type: 'doughnut', data: doughnutData, options:doughnutOptions});
    }
    load_data2();
    load_data();
     $(function(){
        setInterval(function(){
            load_data();
        }, 5000);
    });
</script>
<script src="/static/public_js/fixedsidebar.js"></script>
</body>
</html>
